<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: Vector Packet Processing</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="../css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-xs-12">
        <section id="nav">
          <div class="navbar navbar-default navbar-static-top banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://spdk.io/ci/">
                  <i class="glyphicon glyphicon-ok"></i>
                  <span class="box-name">CI status</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="https://trello.com/b/MN8auadQ/spdk-roadmap">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/news/">
                  <i class="glyphicon glyphicon-bullhorn"></i>
                  <span class="box-name">News</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('vpp_integration.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Vector Packet Processing </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>VPP (part of <a href="https://fd.io/">Fast Data - Input/Output</a> project) is an extensible userspace framework providing networking functionality. It is built around the concept of packet processing graph (see <a href="https://wiki.fd.io/view/VPP/What_is_VPP?">What is VPP?</a>).</p>
<p>Detailed instructions for <b>simplified steps 1-3</b> below, can be found on VPP <a href="https://wiki.fd.io/view/VPP">Quick Start Guide</a>.</p>
<p><em>SPDK supports VPP version 18.01.1.</em></p>
<h1><a class="anchor" id="vpp_build"></a>
1. Building VPP (optional)</h1>
<p><em>Please skip this step if using already built packages.</em></p>
<p>Clone and checkout VPP </p><div class="fragment"><div class="line">git clone https://gerrit.fd.io/r/vpp &amp;&amp; cd vpp</div><div class="line">git checkout v18.01.1</div></div><!-- fragment --><p>Install VPP build dependencies </p><div class="fragment"><div class="line">make install-dep</div></div><!-- fragment --><p>Build and create .rpm packages </p><div class="fragment"><div class="line">make pkg-rpm</div></div><!-- fragment --><p>Alternatively, build and create .deb packages </p><div class="fragment"><div class="line">make pkg-deb</div></div><!-- fragment --><p>Packages can be found in <code>vpp/build-root/</code> directory.</p>
<p>For more in depth instructions please see Building section in <a href="https://wiki.fd.io/view/VPP/Pulling,_Building,_Running,_Hacking_and_Pushing_VPP_Code#Building">VPP documentation</a></p>
<p><em>Please note: VPP 18.01.1 does not support OpenSSL 1.1. It is suggested to install a compatibility package for compilation time.</em> </p><div class="fragment"><div class="line">sudo dnf install -y --allowerasing compat-openssl10-devel</div></div><!-- fragment --><p> <em>Then reinstall latest OpenSSL devel package:</em> </p><div class="fragment"><div class="line">sudo dnf install -y --allowerasing openssl-devel</div></div><!-- fragment --><h1><a class="anchor" id="vpp_install"></a>
2. Installing VPP</h1>
<p>Packages can be installed from a distribution repository or built in previous step. Minimal set of packages consists of <code>vpp</code>, <code>vpp-lib</code> and <code>vpp-devel</code>.</p>
<p><em>Note: Please remove or modify /etc/sysctl.d/80-vpp.conf file with appropriate values dependent on number of hugepages that will be used on system.</em></p>
<h1><a class="anchor" id="vpp_run"></a>
3. Running VPP</h1>
<p>VPP takes over any network interfaces that were bound to userspace driver, for details please see DPDK guide on <a href="http://dpdk.org/doc/guides/linux_gsg/linux_drivers.html#binding-and-unbinding-network-ports-to-from-the-kernel-modules">Binding and Unbinding Network Ports to/from the Kernel Modules</a>.</p>
<p>VPP is installed as service and disabled by default. To start VPP with default config: </p><div class="fragment"><div class="line">sudo systemctl start vpp</div></div><!-- fragment --><p>Alternatively, use <code>vpp</code> binary directly </p><div class="fragment"><div class="line">sudo vpp unix {cli-listen /run/vpp/cli.sock}</div></div><!-- fragment --><p>A usefull tool is <code>vppctl</code>, that allows to control running VPP instance. Either by entering VPP configuration prompt </p><div class="fragment"><div class="line">sudo vppctl</div></div><!-- fragment --><p>Or, by sending single command directly. For example to display interfaces within VPP: </p><div class="fragment"><div class="line">sudo vppctl show interface</div></div><!-- fragment --><h2>Example: Tap interfaces on single host</h2>
<p>For functional test purposes a virtual tap interface can be created, so no additional network hardware is required. This will allow network communication between SPDK iSCSI target using VPP end of tap and kernel iSCSI initiator using the kernel part of tap. A single host is used in this scenario.</p>
<p>Create tap interface via VPP </p><div class="fragment"><div class="line">vppctl tap connect tap0</div><div class="line">vppctl set interface state tapcli-0 up</div><div class="line">vppctl set interface ip address tapcli-0 10.0.0.1/24</div><div class="line">vppctl show int addr</div></div><!-- fragment --><p>Assign address on kernel interface </p><div class="fragment"><div class="line">sudo ip addr add 10.0.0.2/24 dev tap0</div><div class="line">sudo ip link set tap0 up</div></div><!-- fragment --><p>To verify connectivity </p><div class="fragment"><div class="line">ping 10.0.0.1</div></div><!-- fragment --><h1><a class="anchor" id="vpp_built_into_spdk"></a>
4. Building SPDK with VPP</h1>
<p>Support for VPP can be built into SPDK by using configuration option. </p><div class="fragment"><div class="line">configure --with-vpp</div></div><!-- fragment --><p>Alternatively, directory with built libraries can be pointed at and will be used for compilation instead of installed packages. </p><div class="fragment"><div class="line">configure --with-vpp=/path/to/vpp/repo/build-root/vpp</div></div><!-- fragment --><h1><a class="anchor" id="vpp_running_with_spdk"></a>
5. Running SPDK with VPP</h1>
<p>VPP application has to be started before SPDK application, in order to enable usage of network interfaces. For example, if you use SPDK iSCSI target or NVMe-oF target, after the initialization finishes, interfaces configured within VPP will be available to be configured as portal addresses.</p>
<p>Moreover, you do not need to specifiy which TCP sock implementation (e.g., posix, VPP) to be used through configuration file or RPC call. Since SPDK program automatically determines the protocol according to the configured portal addresses info. For example, you can specify a Listen address in NVMe-oF subsystem configuration such as "Listen TCP 10.0.0.1:4420". SPDK programs automatically uses different implemenation to listen this provided portal info via posix or vpp implemenation(if compiled in SPDK program), and only one implementation can successfully listen on the provided portal. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
</div>
