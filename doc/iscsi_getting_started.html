<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: Getting Started Guide</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="banner-header" class="banner-header">
          <div class="banner-message">
            <h1>Storage Performance Development Kit</h1>
            <hr class="banner-divider">
          </div>
        </section>
        <section id="nav">
          <div class="navbar navbar-default banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/roadmap/">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Getting Started Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Intel(R) Storage Performance Development Kit iSCSI target application is named <code>iscsi_tgt</code>. This following section describes how to run iscsi from your cloned package.</p>
<h1><a class="anchor" id="iscsi_prereqs"></a>
Prerequisites</h1>
<p>This guide starts by assuming that you can already build the standard SPDK distribution on your platform. The SPDK iSCSI target has been known to work on several Linux distributions, namely Ubuntu 14.04, 15.04, and 15.10, Fedora 21, 22, and 23, and CentOS 7.</p>
<p>Once built, the binary will be in <code>app/iscsi_tgt</code>.</p>
<h1><a class="anchor" id="iscsi_config"></a>
Configuring iSCSI Target</h1>
<p>A <code>iscsi_tgt</code> specific configuration file is used to configure the iSCSI target. A fully documented example configuration file is located at <code>etc/spdk/iscsi.conf.in</code>.</p>
<p>The configuration file is used to configure the SPDK iSCSI target. This file defines the following: TCP ports to use as iSCSI portals; general iSCSI parameters; initiator names and addresses to allow access to iSCSI target nodes; number and types of storage backends to export over iSCSI LUNs; iSCSI target node mappings between portal groups, initiator groups, and LUNs.</p>
<p>Each LUN in an iSCSI target node is associated with an SPDK block device. See <a class="el" href="bdev_getting_started.html">SPDK bdev Getting Started Guide</a> for details on configuring SPDK block devices. The block device to LUN mappings are specified in the configuration file as:</p>
<div class="fragment"><div class="line">[TargetNodeX]</div><div class="line">  LUN0 Malloc0</div><div class="line">  LUN1 Nvme0n1</div></div><!-- fragment --><p>This exports a malloc'd target. The disk is a RAM disk that is a chunk of memory allocated by iscsi in user space. It will use offload engine to do the copy job instead of memcpy if the system has enough DMA channels.</p>
<p>You should make a copy of the example configuration file, modify it to suit your environment, and then run the iscsi_tgt application and pass it the configuration file using the -c option. Right now, the target requires elevated privileges (root) to run.</p>
<div class="fragment"><div class="line">app/iscsi_tgt/iscsi_tgt -c /path/to/iscsi.conf</div></div><!-- fragment --><h1><a class="anchor" id="iscsi_initiator"></a>
Configuring iSCSI Initiator</h1>
<p>The Linux initiator is open-iscsi.</p>
<p>Installing open-iscsi package Fedora: </p><div class="fragment"><div class="line">yum install -y iscsi-initiator-utils</div></div><!-- fragment --><p>Ubuntu: </p><div class="fragment"><div class="line">apt-get install -y open-iscsi</div></div><!-- fragment --><h2>Setup</h2>
<p>Edit /etc/iscsi/iscsid.conf </p><div class="fragment"><div class="line">node.session.cmds_max = 4096</div><div class="line">node.session.queue_depth = 128</div></div><!-- fragment --><p>iscsid must be restarted or receive SIGHUP for changes to take effect. To send SIGHUP, run: </p><div class="fragment"><div class="line">killall -HUP iscsid</div></div><!-- fragment --><p>Recommended changes to /etc/sysctl.conf </p><div class="fragment"><div class="line">net.ipv4.tcp_timestamps = 1</div><div class="line">net.ipv4.tcp_sack = 0</div><div class="line"></div><div class="line">net.ipv4.tcp_rmem = 10000000 10000000 10000000</div><div class="line">net.ipv4.tcp_wmem = 10000000 10000000 10000000</div><div class="line">net.ipv4.tcp_mem = 10000000 10000000 10000000</div><div class="line">net.core.rmem_default = 524287</div><div class="line">net.core.wmem_default = 524287</div><div class="line">net.core.rmem_max = 524287</div><div class="line">net.core.wmem_max = 524287</div><div class="line">net.core.optmem_max = 524287</div><div class="line">net.core.netdev_max_backlog = 300000</div></div><!-- fragment --><h3>Discovery</h3>
<p>Assume target is at 192.168.1.5 </p><div class="fragment"><div class="line">iscsiadm -m discovery -t sendtargets -p 192.168.1.5</div></div><!-- fragment --><h3>Connect to target</h3>
<div class="fragment"><div class="line">iscsiadm -m node --login</div></div><!-- fragment --><p>At this point the iSCSI target should show up as SCSI disks. Check dmesg to see what they came up as.</p>
<h3>Disconnect from target</h3>
<div class="fragment"><div class="line">iscsiadm -m node --logout</div></div><!-- fragment --><h3>Deleting target node cache</h3>
<div class="fragment"><div class="line">iscsiadm -m node -o delete</div></div><!-- fragment --><p>This will cause the initiator to forget all previously discovered iSCSI target nodes.</p>
<h3>Finding /dev/sdX nodes for iSCSI LUNs</h3>
<div class="fragment"><div class="line">iscsiadm -m session -P 3 | grep &quot;Attached scsi disk&quot; | awk &#39;{print $4}&#39;</div></div><!-- fragment --><p>This will show the /dev node name for each SCSI LUN in all logged in iSCSI sessions.</p>
<h3>Tuning</h3>
<p>After the targets are connected, they can be tuned. For example if /dev/sdc is an iSCSI disk then the following can be done: Set noop to scheduler</p>
<div class="fragment"><div class="line">echo noop &gt; /sys/block/sdc/queue/scheduler</div></div><!-- fragment --><p>Disable merging/coalescing (can be useful for precise workload measurements)</p>
<div class="fragment"><div class="line">echo &quot;2&quot; &gt; /sys/block/sdc/queue/nomerges</div></div><!-- fragment --><p>Increase requests for block queue</p>
<div class="fragment"><div class="line">echo &quot;1024&quot; &gt; /sys/block/sdc/queue/nr_requests</div></div><!-- fragment --> </div></div><!-- contents -->
<footer>
  <div class="container text-center">
    <p class="copyright text-muted small">Copyright Â© Intel Corporation. All Rights Reserved.</p>
  </div>
</footer>
</div>
