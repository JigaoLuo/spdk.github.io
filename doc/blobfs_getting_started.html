<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- For Mobile Devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8">
  <meta name="generator" content="Doxygen 1.8.13">
  <title>SPDK: BlobFS Getting Started Guide</title>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:400,900" type="text/css">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="tabs.css" type="text/css">
  <link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div class="container-fluid">
  <div id="top">  <!-- do not remove this div, it is closed by doxygen! -->
    <div class="row no-gutters">
      <div class="col-sm-12">
        <section id="banner-header" class="banner-header">
          <div class="banner-message">
            <h1>Storage Performance Development Kit</h1>
            <hr class="banner-divider">
          </div>
        </section>
        <section id="nav">
          <div class="navbar navbar-default banner-tabs">
            <ul class="nav navbar-nav">
              <li role="presentation">
                <a href="http://www.spdk.io/">
                  <i class="glyphicon glyphicon-home"></i>
                  <span class="box-name">home</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/releases/">
                  <i class="glyphicon glyphicon-download-alt"></i>
                  <span class="box-name">download</span>
                </a>
              </li>
              <li class="active" role="presentation">
                <a href="index.html">
                  <i class="glyphicon glyphicon-book"></i>
                  <span class="box-name">documentation</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/development/">
                  <i class="glyphicon glyphicon-wrench"></i>
                  <span class="box-name">development</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/community/">
                  <i class="glyphicon glyphicon-envelope"></i>
                  <span class="box-name">community</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/blog/">
                  <i class="glyphicon glyphicon-comment"></i>
                  <span class="box-name">Blog</span>
                </a>
              </li>
              <li role="presentation">
                <a href="http://www.spdk.io/roadmap/">
                  <i class="glyphicon glyphicon-map-marker"></i>
                  <span class="box-name">Roadmap</span>
                </a>
              </li>
            </ul>
          </div>
        </section>
      </div>
    </div>
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">BlobFS Getting Started Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="blobfs_rocksdb"></a>
RocksDB Integration</h1>
<ol type="1">
<li>Build SPDK as normal.</li>
<li>Clone the RocksDB git repo from the SPDK github projects. Make sure you check out the spdk branch. <pre class="fragment"> git clone -b spdk https://github.com/spdk/rocksdb.git
</pre></li>
<li>Build RocksDB. Note that currently only the db_bench benchmarking tool is integrated with BlobFS. (Note: add "DEBUG_LEVEL=0" for a release build.) <pre class="fragment"> make db_bench DPDK_DIR=path/to/dpdk/x86_64-native-linuxapp-gcc SPDK_DIR=path/to/spdk
</pre></li>
<li>Copy etc/spdk/rocksdb.conf.in to /usr/local/etc/spdk/rocksdb.conf.</li>
<li>Append an NVMe section to the configuration file. <pre class="fragment"> scripts/gen_nvme.sh &gt;&gt; /usr/local/etc/spdk/rocksdb.conf
</pre></li>
<li>Verify the configuration file has specified the correct NVMe SSD. If there are any NVMe SSDs you do not wish to use for RocksDB/SPDK testing, remove them from the configuration file.</li>
<li>Make sure you have at least 5GB of memory allocated for huge pages. By default the SPDK setup.sh script only allocates 2GB (1024 huge pages). The following will allocate 5GB worth of 2MB huge pages (in addition to binding the NVMe devices to uio/vfio). If using 1GB huge pages, adjust the NRHUGE value accordingly. <pre class="fragment"> NRHUGE=2560 scripts/setup.sh
</pre></li>
<li>Create an empty SPDK blobfs for testing. <pre class="fragment"> test/lib/blobfs/mkfs/mkfs /usr/local/etc/spdk/rocksdb.conf Nvme0n1
</pre></li>
</ol>
<p>At this point, RocksDB is ready for testing with SPDK. Three db_bench parameters are used to configure SPDK:</p>
<ol type="1">
<li>spdk - Defines the name of the SPDK configuration file. If omitted, RocksDB will use the default PosixEnv implementation instead of SpdkEnv. (Required)</li>
<li><a class="el" href="structspdk__bdev.html" title="SPDK block device. ">spdk_bdev</a> - Defines the name of the SPDK block device which contains the BlobFS to be used for testing. (Required)</li>
<li>spdk_cache_size - Defines the amount of userspace cache memory used by SPDK. Specified in terms of megabytes (MB). Default is 4096 (4GB). (Optional)</li>
</ol>
<p>SPDK has a set of scripts which will run db_bench against a variety of workloads and capture performance and profiling data. The primary script is <code>test/blobfs/rocksdb/run_tests.sh</code>.</p>
<h1>FUSE</h1>
<p>BlobFS provides a FUSE plug-in to mount an SPDK BlobFS as a kernel filesystem for inspection or debug purposes. The FUSE plug-in requires fuse3 and will be built automatically when fuse3 is detected on the system. </p><pre class="fragment">    test/lib/blobfs/fuse/fuse /usr/local/etc/spdk/rocksdb.conf Nvme0n1 /mnt/fuse
</pre><p>Note that the FUSE plug-in has some limitations - see the list below.</p>
<h1>Limitations</h1>
<ul>
<li>BlobFS has primarily been tested with RocksDB so far, so any use cases different from how RocksDB uses a filesystem may run into issues. BlobFS will be tested in a broader range of use cases after this initial release.</li>
<li>Only a synchronous API is currently supported. An asynchronous API has been developed but not thoroughly tested yet so is not part of the public interface yet. This will be added in a future release.</li>
<li>File renames are not atomic. This will be fixed in a future release.</li>
<li>BlobFS currently supports only a flat namespace for files with no directory support. Filenames are currently stored as xattrs in each blob. This means that filename lookup is an O(n) operation. An SPDK btree implementation is underway which will be the underpinning for BlobFS directory support in a future release.</li>
<li>Writes to a file must always append to the end of the file. Support for writes to any location within the file will be added in a future release. </li>
</ul>
</div></div><!-- contents -->
<footer>
  <div class="container text-center">
    <p class="copyright text-muted small">Copyright Â© Intel Corporation. All Rights Reserved.</p>
  </div>
</footer>
</div>
